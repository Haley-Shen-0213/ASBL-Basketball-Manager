# ASBL 賽程排定與優化規格書 (v1.0)

**版本**: 1.0
**文件類型**: 演算法規格 (Algorithm Specification)
**狀態**: 正式定案 (Production Ready)
**最後更新**: 2026-02-20
**數據來源**: 20260220_1410 大數據測試報告 (N=100M)

---

## 1. 系統概述 (Overview)

本文件定義 ASBL 聯賽賽程生成的優化邏輯。由於標準的圓桌法 (Round-Robin) 賽程雖然公平，但若直接隨機打亂日期，容易產生極端的主客場連續場次（例如連續 8 場客場），這對球隊體力與經營（票房）皆不公平。

本系統採用 **蒙地卡羅模擬 (Monte Carlo Simulation)** 結合 **積分懲罰機制 (Penalty Scoring System)**，透過大量隨機生成與篩選，找出「既具備隨機變化性」又「符合主客場平衡」的最佳賽程。

---

## 2. 賽程生成流程 (Generation Workflow)

### 2.1 基礎賽程產生
*   **演算法**: 標準圓桌法 (Round-Robin Scheduling)。
*   **規模**: 36 支球隊，雙循環，共 70 輪 (Days)。
*   **特性**: 確保每支球隊與其他球隊各對戰兩次 (一主一客)。此階段產生的賽程是固定的對戰組合，僅「日期順序」待定。

### 2.2 隨機打亂 (Shuffling)
*   將上述產生的 70 輪賽程，以「輪 (Day)」為單位進行隨機排序。
*   *目的*: 打破圓桌法的固定規律，增加賽程的不可預測性。

### 2.3 積分計算與懲罰 (Scoring & Penalty)
針對打亂後的賽程，計算每支球隊的「連續主場」或「連續客場」情況，並給予懲罰積分。**積分越低代表賽程越優質（連續場次越少）。**

**計算規則 (累加制)**：
遍歷每支球隊的 70 場比賽，當出現連續相同場地 (Streak) 時，依下表累加積分：

| 連續場次 (Streak) | 懲罰積分 | 說明 |
| :--- | :--- | :--- |
| **2 場** | **+1** | 可接受的微小波動。 |
| **3 場** | **+3** | 稍微疲勞/連續獲利，需關注。 |
| **4 場** | **+5** | 不理想的安排。 |
| **5 場** | **+10** | 嚴重影響平衡。 |
| **6 場以上** | **+30** | **極端惡劣**，必須極力避免。 |

*   **總積分**: 將 36 支球隊的懲罰積分加總，即為該份賽程的 `Total_Score`。

---

## 3. 大數據分析基準 (Statistical Benchmarks)

基於 **100,000,000 (一億次)** 的蒙地卡羅模擬結果，制定以下品質標準。

### 3.1 統計數據分佈
*   **最低積分 (Best Score)**: **1016** (理論極值)
*   **最高積分 (Worst Score)**: **5736** (極端惡劣)
*   **平均值 (Mean)**: **2543.91**

### 3.2 品質門檻
*   **Top 0.1%**: < **1461**
*   **Top 1%**: < **1651**
*   **Top 5%**: < **1850**

---

## 4. 生產環境執行策略 (Production Strategy)

本章節定義換季時的實際執行參數。

### 4.1 執行參數 (Execution Parameters)
*   **目標運算次數**: **30,000,000 (三千萬次)**
*   **預估耗時**: **約 24.2 分鐘** (基於 i9-14900K 算力推估)
*   **硬體資源**: 啟用多核心平行運算 (Multiprocessing)。

### 4.2 篩選與決策 (Selection Logic - Elite Mode)
採用 **「菁英池隨機抽選 (Elite Pool Random Selection)」** 策略：

1.  **收集階段**:
    *   系統執行 3000 萬次模擬。
    *   維護一個 **Min-Heap (最小堆積)** 或排序列表，即時保留積分最低的前 **1,000** 組賽程。

2.  **決策階段**:
    *   運算結束後，從這 **1,000 組** 最優解中，**隨機抽取 1 組** 作為最終賽程。

3.  **預期品質**:
    *   預估積分範圍：**1016 ~ 1150** (約 Top 0.003%)。
    *   此範圍內的賽程幾乎不包含 4 連主/客場，為理論上的完美賽程。

---

## 5. 系統資源監控 (Resource Monitoring)

執行換季程式時，需監控以下指標以確保系統穩定：
*   **CPU 使用率**: 監控多核心負載平衡。
*   **記憶體 (RAM)**: 由於僅需保留 Top 1000，記憶體佔用極低，無需特別擔心。
*   **執行時間**: 若執行時間超過 40 分鐘，應觸發超時警報並使用當前最佳解。