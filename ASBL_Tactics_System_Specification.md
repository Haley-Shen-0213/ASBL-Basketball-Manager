# ASBL 戰術與陣容設定規格書 (v1.0)

**版本**: 1.0
**文件類型**: 系統規格 (System Specification)
**狀態**: 待實作 (Pending Implementation)
**最後更新**: 2026-02-16

---

## 1. 系統概述 (Overview)
本文件定義了球隊在比賽前的 **陣容提交 (Roster Submission)** 與 **戰術設定 (Tactics Setting)** 規則。

核心目標是限制強隊無限制地堆疊高階球員（如全隊 15 人皆為明星），強制玩家進行陣容取捨，並提供自動化的防呆機制，確保每場比賽皆有合法的 15 人名單出賽。

---

## 2. 登錄名單規則 (Active Roster Rules)

### 2.1 人數限制
*   每場比賽必須提交一份 **15 人** 的登錄名單 (Active Roster)。
*   未進入登錄名單的簽約球員視為 **非登錄 (Inactive)**，該場比賽無法上場。

### 2.2 角色階層限制 (Role Constraints)
為了維持聯盟平衡與薪資結構合理性，登錄名單中的球員 **合約角色 (Contract Role)** 必須符合以下階層限制。

> **注意**：此限制是針對「合約上的角色」，而非球員當下的能力值。

| 階層 (Tier) | 包含角色 | 累計上限 (Cumulative Max) | 說明 |
| :--- | :--- | :--- | :--- |
| **Tier 1** | **明星 (Star)** | **Max 3 人** | 一支球隊最多只能登錄 3 名核心巨星。 |
| **Tier 2** | **明星 + 先發** | **Max 5 人** | 主力陣容上限 5 人。若明星未滿 3 人，名額可流用給先發。 |
| **Tier 3** | **明星 + 先發 + 綠葉 + 功能** | **Max 12 人** | 主要輪替圈上限 12 人。 |
| **Tier 4** | **全體 (含板凳)** | **Fixed 15 人** | 剩餘名額 (至少 3 人) 必須由板凳 (Bench) 填補。 |

**範例情境**：
*   **合法**：3 Star, 2 Starter, 7 Rotation, 3 Bench (3<=3, 5<=5, 12<=12)。
*   **合法**：0 Star, 5 Starter, 0 Rotation, 10 Bench (0<=3, 5<=5, 5<=12)。
*   **違規**：4 Star (違反 Tier 1)。
*   **違規**：2 Star, 4 Starter (合計 6 人，違反 Tier 2)。
*   **違規**：0 Star, 0 Starter, 13 Rotation (違反 Tier 3)。

---

## 3. 自動填補機制 (Auto-Fill Logic)

若玩家未設定名單，或提交的名單不滿 15 人/不符合規則，系統將啟動 **自動填補 (Auto-Fill)**。

### 3.1 執行邏輯
系統將遍歷球隊所有簽約球員，依據 `Rating` (能力總和) 由高至低排序，並依序填入符合上述限制的空缺。

### 3.2 填補演算法 (Algorithm)

1.  **準備池 (Pool)**：取得該隊所有簽約球員，依 `attr_sum` 降冪排序。
2.  **初始化名單**：建立空的 `roster = []`。
3.  **Tier 1 填補 (Star)**：
    *   從 Pool 中選取角色為 `Star` 的球員。
    *   填入 `roster`，直到達到 **3人** 上限或無 `Star` 可選。
4.  **Tier 2 填補 (Starter)**：
    *   從 Pool 中選取角色為 `Starter` 的球員。
    *   填入 `roster`，直到 (`Star` + `Starter`) 達到 **5人** 上限。
5.  **Tier 3 填補 (Rotation/Role)**：
    *   從 Pool 中選取角色為 `Rotation` 或 `Role` 的球員。
    *   填入 `roster`，直到 (`Star` + `Starter` + `Rotation` + `Role`) 達到 **12人** 上限，**或已無 `Rotation` / `Role` 球員可選**。
6.  **Tier 4 填補 (Bench Only)**：
    *   從 Pool 中選取角色為 **`Bench`** 的球員。
    *   **嚴格限制**：此階段 **不接受** 因名額限制被擠下來的高階球員 (例如第 4 位 Star 或第 6 位 Starter)。
    *   填入 `roster`，直到總人數達到 **15人**，或已無 `Bench` 球員可選。

### 3.3 緊急填補機制 (Emergency Fill - Phantom Players)

若執行完上述步驟後，名單仍不足 15 人（例如全隊只有 10 名 Bench 球員，或沒有 Bench 球員），系統將啟動緊急機制。

*   **觸發條件**：`len(roster) < 15`。
*   **執行動作**：系統自動生成 **(15 - 當前人數)** 名 **「幽靈球員 (Phantom Players)」** 填補空缺。
*   **幽靈球員屬性**：
    *   **等級 (Grade)**：固定為 **G**。
    *   **角色 (Role)**：固定為 **Bench**。
    *   **能力值**：依據 G 級標準隨機生成 (即戰力低)。
    *   **資料紀錄 (Data Persistence)**：
        *   **不存入資料庫**：比賽結束後即銷毀。
        *   **不記錄數據**：其在比賽中產生的得分、籃板等數據，**不計入** 生涯累積數據，也不會出現在排行榜上 (但在當場比賽的 Box Score 中仍需顯示以維持數據平衡)。
        *   **不佔薪資**：不影響球隊薪資空間。

---

## 4. 角色定義與參數 (Reference)

*(引用自 ASBL_Player_System_Specification.md v3.5)*

### 4.1 角色定位定義
球員生成時，依據等級自動賦予初始合約年限與角色定位。此角色即為上述限制的判斷依據。

| 等 級 | 合約年限 | 角色定位 (Role) | 說明 |
| :--- | :--- | :--- | :--- |
| **SSR** | **4 季** | **明星 (Star)** | 絕對核心，享有最高薪資加成與上場時間。 |
| **SS** | **4 季** | **明星 (Star)** | 絕對核心，享有最高薪資加成與上場時間。 |
| **S** | **4 季** | **先發 (Starter)** | 球隊主力。 |
| **A** | **2 季** | **綠葉 (Rotation)** | 主要輪替球員。 |
| **B** | **2 季** | **綠葉 (Rotation)** | 主要輪替球員。 |
| **C** | **1 季** | **功能 (Role)** | 功能性球員，特定戰術使用。 |
| **G** | **1 季** | **板凳 (Bench)** | 邊緣球員/陪練，填補名單使用。 |

---

## 5. 比賽引擎整合 (Match Engine Integration)

當 15 人名單確定後，比賽引擎將接手進行調度。以下邏輯僅針對這 15 人進行運算。

*(引用自 ASBL_Match_Engine_Specification.md v2.4)*

### 5.1 先發陣容決定邏輯 (Starting Lineup)
系統依據以下優先順序填入先發五人 (PG, SG, SF, PF, C)。
填入順序按照 **明星** -> **先發** -> **其他** (PG, C, SG, SF, PF)：

1.  **明星優先 (Star Priority)**
    *   隊伍中的 `Star` 球員擁有最高優先權。
    *   若有多位 `Star`，依據「位置評分」最高的順位優先鎖定位置。
2.  **先發填補 (Starter Fill)**
    *   `Star` 分配完畢後，由 `Starter` 球員填補剩餘空缺。
3.  **剩餘填補 (Fill Gaps)**
    *   若 5 個位置仍有空缺，由剩餘球員中「該位置評分最高者」填補。

### 5.2 輪替排序 (Rotation Order)
*   非先發球員依據各位置評分高低列入替補名單。
*   實際換人時機由體力系統控制。
*   若球員已達時間上限，非必要不上場。

### 5.3 比賽時間分配 (Minutes Distribution)
系統需將 240 分鐘分配給登錄球員，作為換人參考。

*   **分配演算法**: `個人時間 = 保底時間 + (權重 * 單位時間價值)`。
*   **計算邏輯**:
    1.  扣除總保底時間，剩餘時間依權重比例分配。
    2.  計算結果無條件捨去至小數點第一位。
    3.  尾數誤差補給最後一位球員。

**角色參數表**:

| 角色 | 保底時間 (Base) | 權重範圍 (Weight) |
| :--- | :--- | :--- |
| **Star** | 30 min | -1 ~ 5 |
| **Starter** | 20 min | -2 ~ 7 |
| **Rotation** | 10 min | 5 ~ 15 |
| **Role** | 0 min | 5 ~ 12 |
| **Bench** | 0 min | 0 ~ 10 |