# ASBL 籃球遊戲球員系統規格書 (v2.2)

**版本**：2.2
**狀態**：已定案 (Confirmed)
**最後更新**：2025-12-03
**變更記錄**：
*   **v1.0 (2025-12-03)**：初始版本，定義生成、成長、老化邏輯。
*   **v2.0 (2025-12-03)**：
    *   **移除**：體重 (Weight) 生成系統。
    *   **修改**：可訓練能力生成邏輯，由「壓縮機制」改為「重骰機制 (Reroll)」，允許極端偏科數值出現。
*   **v2.1**：
    *   **修正**：移除薪資公式中的 `* 100` 倍率。
    *   **格式**：將數學公式改為純文字格式以便閱讀。
*   **v2.2**：
    *   **修改**：姓名生成邏輯，針對「姓氏」設定長度機率 (80/15/5)。
    *   **新增**：定義開隊陣容檢核標準 (C>=2, PG>=2, G>=4, F>=4)。
---

## 1. 系統概述
本文件定義了 ASBL (Advanced Simulation Basketball League) 中球員生成、能力值分配、成長與老化機制的核心邏輯。設計目標是創造一個具備高度策略性、隨機性與經營深度的籃球模擬環境。

---

## 2. 球員生成系統 (Player Generation)

### 2.1 姓名生成 (Name Generation)
*   **資料來源**：`NameLibrary` 資料庫 (分為 `last` 姓氏庫 與 `first` 名字庫)。
*   **生成流程**：
    1.  隨機抽取一個 **姓氏 (Last Name)**。
        *   **80%**：單字 (如：林)      **(v2.2 更新)**
        *   **15%**：雙字 (如：歐陽)    **(v2.2 更新)**
        *   **5%**：長字 (3字以上)      **(v2.2 更新)**
    2.  隨機抽取一個 **名字 (First Name)**。
    3.  組合為 `FullName`。
*   **補字邏輯 (Add Character Logic)**：
    *   **觸發條件**：
        1.  `FullName` 總長度 $\le 2$ (如：林豪)。
        2.  `Last` 長度 $> 1$ 且 `First` 長度 $= 1$ (如：歐陽鋒)。
    *   **機率**：符合上述任一條件時，**50% 機率** 觸發補字。
    *   **執行補字**：
        *   從 `first` 庫中再抽取一個字。
        *   **防呆檢查**：若抽到的字長度 $> 1$ (如抽到「志豪」)，則**強制取消補字**，維持原名 (避免出現「歐陽鋒志豪」)。
        *   若抽到的字長度 $= 1$，則追加至名字後方。
    *   **例外處理 1.**：外國譯名通常長度已 $> 2$ 且不符合複姓單名規則，故不觸發補字。
    *   **例外處理 2.**：補字時從名字庫再抽一字，若抽到多字詞則取消補字。

### 2.2 身高與位置 (Height & Position)
*   **身高生成**：
    *   演算法：Box-Muller Transform (常態分佈)。
    *   參數：平均值 (Mean) **195cm**，標準差 (SD) **10**。
    *   範圍限制：**160cm ~ 230cm**。
*   **位置判定**：由身高決定機率分佈 (非絕對切斷)。
    *   **< 190cm**：PG (60%), SG (40%)
    *   **190-199cm**：PG (35%), SG (45%), SF (20%)
    *   **200-209cm**：PF (50%), C (15%), SF (20%), SG (10%), PG (5%)
    *   **>= 210cm**：C (45%), PF (30%), SF (10%), SG (10%), PG (5%)

### 2.3 等級與能力值 (Grade & Stats)
*   **等級機率 (Drop Rates)**：
    *   **G**: 28% 
    *   **C**: 26%
    *   **B**: 22%
    *   **A**: 14% 
    *   **S**: 7% 
    *   **SS**: 2.5% 
    *   **SSR**: 0.5% 

#### 2.3.1 不可訓練能力 (Untrainable Stats)
*   **定義**：代表球員的天賦，生成後無法透過訓練提升。
*   **項目 (10項)**：`體力`, `力量`, `速度`, `彈跳`, `手感`, `出手速度`, `進攻智商`, `防守智商`, `健康`, `運氣(Luck)`。
*   **生成規則**：
    *   根據等級設定 **總分範圍 (Sum Range)** 與 **單項範圍 (Stat Range)**。
    *   SSR 級擁有極高的總分下限 (951+)，保證天賦異稟。
    *   G 級總分低於 400。

#### 2.3.2 可訓練能力 (Trainable Stats)
*   **定義**：代表球員的技術，可透過比賽獲得點數提升。
*   **項目 (10項)**：`投籃準心`, `射程`, `籃板`, `卡位`, `干擾`, `抄截`, `跑位`, `運球`, `傳球`, `控球`。
*   **生成規則**：
    1.  **隨機生成**：每項能力在 **1~99** 之間完全隨機生成。
    2.  **反向總上限限制 (Reverse Cap)**：
        *   等級越低，初始技術總和上限越高 (即戰力)。
        *   等級越高，初始技術總和上限越低 (需培養)。
        *   **G**: 上限 800
        *   **C**: 上限 700
        *   **B**: 上限 650
        *   **A**: 上限 600
        *   **S/SS/SSR**: 上限 550
    3.  **重骰機制 (Reroll)** (v2.0 更新)：
        *   若隨機生成的 10 項能力總和 **超過** 該等級上限，則視為無效，**重新隨機生成**。
        *   重複此步驟直到生成出一組總和低於上限的數值為止。
        *   *此機制允許出現單項極高 (99) 但其他項極低 (1) 的偏科型球員。*
        **(v1.0 原始設計-已更新刪除)壓縮機制**：~~若隨機生成總和超過上限，則按比例壓縮各項數值~~。

---

## 3. 成長與老化系統 (Growth & Aging)

### 3.1 基礎參數
*   **賽季設定**：1 賽季 = **91 天** (70 場比賽)。
*   **初始年齡**：18 歲。
*   **體能極限**：單場上場時間上限約 **37 分鐘**。

### 3.2 成長期 (18 - 25 歲)
*   **機制**：累積上場時間換取訓練點數。
*   **公式**：每累積 48 分鐘 -> 獲得 1 點。
*   **幸運修正 (Luck Modifier)**：
    *   基準值：Luck 80。
    *   修正公式：實際獲得 = 基礎點數 * [1 + (Luck - 80) * 1%]。
    *   *效果：Luck 99 的球員成長速度快 19%。*

### 3.3 巔峰期 (26 - 29 歲)
*   **機制**：成長速度放緩。
*   **公式**：每累積 144 分鐘 -> 獲得 1 點。
*   **幸運修正**：同上。

### 3.4 退化期 (30 歲以上)
*   **機制**：非線性加速老化，包含「上場磨損」與「歲月流逝」。
*   **抗性系統 (Resilience)**：
    *   **幸運抗性**：[(Luck - 70) * 1%] (若 Luck < 70 則為 0)。
    *   **等級抗性**：A (1%), S (3%), SS (5%), SSR (10%)。
    *   **總抗性** = 幸運抗性 + 等級抗性。
*   **掉點公式 (負成長)**：
    1.  **上場磨損**：滿 [300 / MAX(1, Age-29)] 分鐘 -> 扣 1 點。
        *   *隨著年齡增加，分母變小，掉點門檻降低。*
    2.  **歲月流逝**：每 [10 - (Age-30)] 天 -> 扣 1 點。
        *   *隨著年齡增加，天數變少，掉點頻率變高。*
    3.  **抗性應用**：上述兩種扣點計算出的數值，扣點數 * (1 - 總抗性)。
*   **練球補償**：滿 [150 * (Age-29)] 分鐘 -> 補 1 點。

---

## 4. 經濟與其他 (Economy & Misc)

### 4.1 薪資計算 (Salary)
*   **公式**：所有能力總和 * 等級係數。**(v2.1 更新)**
*   **等級係數**：
    *   G: 1.0
    *   C: 1.1
    *   B: 1.3
    *   A: 1.6
    *   S: 2.0
    *   SS: 2.5
    *   SSR: 3.0

### 4.2 點數分配
*   **分配方式**：**手動分配 (Manual)**。
*   **儲存**：球員獲得的訓練點數存入 `training_points` 欄位，由玩家決定加到哪一項可訓練能力上。

### 4.3 體重 (Weight)
*   **(v2.0 已移除)**
*   **(v1.0 公式 - 已移除)**：~~$(\text{Height} - 100) \times 0.9 + \text{Random}(-5, 5)$。~~

## 5. 開隊陣容檢核 (Team Creation Validation) **(v2.2 新增)**
*   **執行邏輯**：生成 15 人名單 -> 檢查條件 -> 若不符合則整隊重骰。
*   **檢核條件**：
    1.  **C (中鋒)** 數量至少 2 人。
    2.  **PG (控球後衛)** 數量至少 2 人。
    3.  **後衛組 (PG + SG)** 總數至少 4 人。
    4.  **前鋒組 (PF + SF)** 總數至少 4 人。
*   **等級檢核條件**：
    *   **G 級**：5 人
    *   **C 級**：3 人
    *   **B 級**：2 人
    *   **A 級**：2 人
    *   **S 級**：1 人
    *   **SS 級**：1 人
    *   **SSR 級**：1 人