# ASBL 籃球遊戲球員系統規格書 (v2.6) ASBL_Player_System_Specification.md

**版本**：2.6
**狀態**：已定案 (Confirmed)
**最後更新**：2025-12-11
**變更記錄**：
*   **v1.0 (2025-12-03)**：初始版本，定義生成、成長、老化邏輯。
*   **v2.0 (2025-12-03)**：
    *   **移除**：體重 (Weight) 生成系統。
    *   **修改**：可訓練能力生成邏輯，由「壓縮機制」改為「重骰機制 (Reroll)」，允許極端偏科數值出現。
*   **v2.1 (2025-12-03)**：
    *   **修正**：移除薪資公式中的 `* 100` 倍率。
    *   **格式**：將數學公式改為純文字格式以便閱讀。
*   **v2.2 (2025-12-03)**：
    *   **修改**：姓名生成邏輯，針對「姓氏」設定長度機率 (80/15/5)。
    *   **新增**：定義開隊陣容檢核標準 (C>=2, PG>=2, G>=4, F>=4)。
*   **v2.4 (2025-12-04)**：
    *   **新增**：球員初始年齡生成規則 (SSR 固定 18 歲，隨等級下降範圍擴大)。
    *   **新增**：初始合約規則 (年限與角色定位與等級掛鉤)。
*   **v2.5 (2025-12-04)**：
    *   **新增**：第 6 章「上場時間分配系統 (Minutes Distribution System)」。
    *   **定義**：各角色定位 (Role) 的保底時間與權重浮動範圍。
    *   **演算法**：定義基於權重的動態時間分配公式。
*   **v2.6 (2025-12-11)**：
    *   **新增**：球員屬性的欄位定義。
    *   **用途**：確保後續設計程式時能保持一致性。

---

## 1. 系統概述
本文件定義了 ASBL (Advanced Simulation Basketball League) 中球員生成、能力值分配、成長與老化機制的核心邏輯。設計目標是創造一個具備高度策略性、隨機性與經營深度的籃球模擬環境。

---

## 2. 球員生成系統 (Player Generation)

### 2.1 姓名生成 (Name Generation)
*   **資料來源**：`NameLibrary` 資料庫 (分為 `last` 姓氏庫 與 `first` 名字庫)。
*   **生成流程**：
    1.  隨機抽取一個 **姓氏 (Last Name)**。
        *   **80%**：單字 (如：林)      **(v2.2 更新)**
        *   **15%**：雙字 (如：歐陽)    **(v2.2 更新)**
        *   **5%**：長字 (3字以上)      **(v2.2 更新)**
    2.  隨機抽取一個 **名字 (First Name)**。
    3.  組合為 `FullName`。
*   **補字邏輯 (Add Character Logic)**：
    *   **觸發條件**：
        1.  `FullName` 總長度 $\le 2$ (如：林豪)。
        2.  `Last` 長度 $> 1$ 且 `First` 長度 $= 1$ (如：歐陽鋒)。
    *   **機率**：符合上述任一條件時，**50% 機率** 觸發補字。
    *   **執行補字**：
        *   從 `first` 庫中再抽取一個字。
        *   **防呆檢查**：若抽到的字長度 $> 1$ (如抽到「志豪」)，則**強制取消補字**，維持原名 (避免出現「歐陽鋒志豪」)。
        *   若抽到的字長度 $= 1$，則追加至名字後方。
    *   **例外處理 1.**：外國譯名通常長度已 $> 2$ 且不符合複姓單名規則，故不觸發補字。
    *   **例外處理 2.**：補字時從名字庫再抽一字，若抽到多字詞則取消補字。

### 2.2 身高與位置 (Height & Position)
*   **身高生成**：
    *   演算法：Box-Muller Transform (常態分佈)。
    *   參數：平均值 (Mean) **195cm**，標準差 (SD) **10**。
    *   範圍限制：**160cm ~ 230cm**。
*   **位置判定**：由身高決定機率分佈 (非絕對切斷)。
    *   **< 190cm**：PG (60%), SG (40%)
    *   **190-199cm**：PG (35%), SG (45%), SF (20%)
    *   **200-209cm**：PF (50%), C (15%), SF (20%), SG (10%), PG (5%)
    *   **>= 210cm**：C (45%), PF (30%), SF (10%), SG (10%), PG (5%)

### 2.3 等級與能力值 (Grade & Stats)
*   **等級機率 (Drop Rates)**：
    *   **G**: 28% 
    *   **C**: 26%
    *   **B**: 22%
    *   **A**: 14% 
    *   **S**: 7% 
    *   **SS**: 2.5% 
    *   **SSR**: 0.5% 

#### 2.3.1 不可訓練能力 (Untrainable Stats)
*   **定義**：代表球員的天賦，生成後無法透過訓練提升。
*   **項目 (10項)**：`體力`, `力量`, `速度`, `彈跳`, `手感`, `出手速度`, `進攻智商`, `防守智商`, `健康`, `運氣(Luck)`。
*   **生成規則**：
    *   根據等級設定 **總分範圍 (Sum Range)** 與 **單項範圍 (Stat Range)**。
    *   SSR 級擁有極高的總分下限 (951+)，保證天賦異稟。
    *   G 級總分低於 400。

**(V2.6 新增)**
| 中文名稱 | Config Key (YAML) | DB Field (Storage) | 備註說明 |
| :--- | :--- | :--- | :--- |
| **體力** | `ath_stamina` | `physical.stamina` | 影響體力以及比賽中能力變化 |
| **力量** | `ath_strength` | `physical.strength` | 基本運動能力，影響比賽表現 |
| **速度** | `ath_speed` | `physical.speed` | 基本運動能力，影響比賽表現 |
| **彈跳** | `ath_jump` | `physical.jumping` | 基本運動能力，影響比賽表現 |
| **健康** | `talent_health` | `physical.health` | 影響受傷機率與體力恢復加成 (隱藏數值) |
| **手感** | `shot_touch` | `offense.touch` | 影響投籃命中判定 |
| **出手速度** | `shot_release` | `offense.release` | 影響投籃命中判定 |
| **進攻智商** | `talent_offiq` | `mental.off_iq` | 影響投籃命中判定與進攻事件 |
| **防守智商** | `talent_defiq` | `mental.def_iq` | 影響投籃命中判定與防守事件 |
| **運氣** | `talent_luck` | `mental.luck` | 影響所有機率事件的微幅修正 (隱藏數值) |

#### 2.3.2 可訓練能力 (Trainable Stats)
*   **定義**：代表球員的技術，可透過比賽獲得點數提升。
*   **項目 (10項)**：`投籃準心`, `射程`, `籃板`, `卡位`, `干擾`, `抄截`, `跑位`, `運球`, `傳球`, `控球`。
*   **生成規則**：
    1.  **隨機生成**：每項能力在 **1~99** 之間完全隨機生成。
    2.  **反向總上限限制 (Reverse Cap)**：
        *   等級越低，初始技術總和上限越高 (即戰力)。
        *   等級越高，初始技術總和上限越低 (需培養)。
        *   **G**: 上限 800
        *   **C**: 上限 700
        *   **B**: 上限 650
        *   **A**: 上限 600
        *   **S/SS/SSR**: 上限 550
    3.  **重骰機制 (Reroll)** (v2.0 更新)：
        *   若隨機生成的 10 項能力總和 **超過** 該等級上限，則視為無效，**重新隨機生成**。
        *   重複此步驟直到生成出一組總和低於上限的數值為止。
        *   *此機制允許出現單項極高 (99) 但其他項極低 (1) 的偏科型球員。*
        **(v1.0 原始設計-已更新刪除)壓縮機制**：~~若隨機生成總和超過上限，則按比例壓縮各項數值~~。

**(V2.6 新增)**
| 中文名稱 | Config Key (YAML) | DB Field (Storage) | 備註說明 |
| :--- | :--- | :--- | :--- |
| **投籃準心** | `shot_accuracy` | `offense.accuracy` | 影響投籃命中判定 |
| **射程** | `shot_range` | `offense.range` | 影響投籃命中判定 |
| **傳球** | `off_pass` | `offense.passing` | 影響進攻事件 |
| **運球** | `off_dribble` | `offense.dribble` | 影響進攻事件 |
| **控球** | `off_handle` | `offense.handle` | 影響進攻事件 |
| **跑位** | `off_move` | `offense.move` | 影響進攻事件及防守事件 |
| **籃板** | `def_rebound` | `defense.rebound` | 影響籃板事件 |
| **卡位** | `def_boxout` | `defense.boxout` | 影響籃板事件 |
| **干擾** | `def_contest` | `defense.contest` | 影響防守事件 |
| **抄截** | `def_disrupt` | `defense.disrupt` | 影響防守事件 |

### 2.4 年齡生成 (Age Generation) **(v2.4 新增)**
*   **基礎規則**：SSR 級固定為 18 歲，每降一級，年齡浮動範圍 (Range) 增加 1 歲。
*   **公式**：`Age = 18 + Random(0, Grade_Offset)`
*   **各級對照**：
    *   **SSR**: 18 歲 (固定)
    *   **SS**: 18 ~ 19 歲
    *   **S**: 18 ~ 20 歲
    *   **A**: 18 ~ 21 歲
    *   **B**: 18 ~ 22 歲
    *   **C**: 18 ~ 23 歲
    *   **G**: 18 ~ 24 歲

---

## 3. 成長與老化系統 (Growth & Aging)

### 3.1 基礎參數
*   **賽季設定**：1 賽季 = **91 天** (70 場比賽)。
*   **初始年齡**：18 歲。
*   **體能極限**：單場上場時間上限約 **37 分鐘**。

### 3.2 成長期 (18 - 25 歲)
*   **機制**：累積上場時間換取訓練點數。
*   **公式**：每累積 48 分鐘 -> 獲得 1 點。
*   **幸運修正 (Luck Modifier)**：
    *   基準值：Luck 80。
    *   修正公式：實際獲得 = 基礎點數 * [1 + (Luck - 80) * 1%]。
    *   *效果：Luck 99 的球員成長速度快 19%。*

### 3.3 巔峰期 (26 - 29 歲)
*   **機制**：成長速度放緩。
*   **公式**：每累積 144 分鐘 -> 獲得 1 點。
*   **幸運修正**：同上。

### 3.4 退化期 (30 歲以上)
*   **機制**：非線性加速老化，包含「上場磨損」與「歲月流逝」。
*   **抗性系統 (Resilience)**：
    *   **幸運抗性**：[(Luck - 70) * 1%] (若 Luck < 70 則為 0)。
    *   **等級抗性**：A (1%), S (3%), SS (5%), SSR (10%)。
    *   **總抗性** = 幸運抗性 + 等級抗性。
*   **掉點公式 (負成長)**：
    1.  **上場磨損**：滿 [300 / MAX(1, Age-29)] 分鐘 -> 扣 1 點。
        *   *隨著年齡增加，分母變小，掉點門檻降低。*
    2.  **歲月流逝**：每 [10 - (Age-30)] 天 -> 扣 1 點。
        *   *隨著年齡增加，天數變少，掉點頻率變高。*
    3.  **抗性應用**：上述兩種扣點計算出的數值，扣點數 * (1 - 總抗性)。
*   **練球補償**：滿 [150 * (Age-29)] 分鐘 -> 補 1 點。

---

## 4. 經濟與其他 (Economy & Misc)

### 4.1.1 薪資計算 (Salary)
*   **公式**：所有能力總和 * 等級係數。**(v2.1 更新)**
*   **等級係數**：
    *   G: 1.0
    *   C: 1.1
    *   B: 1.3
    *   A: 1.6
    *   S: 2.0
    *   SS: 2.5
    *   SSR: 3.0

### 4.1.2 初始合約規則 (Initial Contract) **(v2.4 新增)**
球員生成時，依據等級自動賦予初始合約年限與角色定位。

|  等 級  | 合約年限  |  角色定位 (Role)    | 說明                                |
| :---    | :---     | :---               | :---                                |
| **SSR** | **4 季** | **明星 (Star)**     | 絕對核心，享有最高薪資加成與上場時間。 |
| **SS**  | **4 季** | **先發 (Starter)**  | 球隊主力。                           |
| **S**   | **4 季** | **先發 (Starter)**  | 球隊主力。                           |
| **A**   | **2 季** | **綠葉 (Rotation)** | 主要輪替球員。                       |
| **B**   | **2 季** | **綠葉 (Rotation)** | 主要輪替球員。                       |
| **C**   | **1 季** | **功能 (Role)**     | 功能性球員，特定戰術使用。            |
| **G**   | **1 季** | **板凳 (Bench)**    | 邊緣球員/陪練，填補名單使用。         |

### 4.2 點數分配
*   **分配方式**：**手動分配 (Manual)**。
*   **儲存**：球員獲得的訓練點數存入 `training_points` 欄位，由玩家決定加到哪一項可訓練能力上。

### 4.3 體重 (Weight)
*   **(v2.0 已移除)**
*   **(v1.0 公式 - 已移除)**：~~$(\text{Height} - 100) \times 0.9 + \text{Random}(-5, 5)$。~~

## 5. 開隊陣容檢核 (Team Creation Validation) **(v2.2 新增)**
*   **執行邏輯**：生成 15 人名單 -> 檢查條件 -> 若不符合則整隊重骰。
*   **檢核條件**：
    1.  **C (中鋒)** 數量至少 2 人。
    2.  **PG (控球後衛)** 數量至少 2 人。
    3.  **後衛組 (PG + SG)** 總數至少 4 人。
    4.  **前鋒組 (PF + SF)** 總數至少 4 人。
*   **等級檢核條件**：
    *   **G 級**：5 人
    *   **C 級**：3 人
    *   **B 級**：2 人
    *   **A 級**：2 人
    *   **S 級**：1 人
    *   **SS 級**：1 人
    *   **SSR 級**：1 人
    
---

## 6. 上場時間分配系統 (Minutes Distribution System) **(v2.5 新增)**

### 6.1 系統概述
比賽模擬時，系統需將 **240 分鐘** (48分鐘 x 5人) 分配給登錄名單中的球員。分配機制採用 **「保底時間 + 權重浮動」** 演算法，確保核心球員地位，同時保留單場比賽的隨機性與調度彈性。

### 6.2 角色參數設定
不同合約角色擁有不同的「保底時間 (Base)」與「權重範圍 (Weight Range)」。

| 角色定位 (Role) | 保底時間 (Base) | 權重範圍 (Weight) | 說明 |
| :--- | :--- | :--- | :--- |
| **明星 (Star)** | **30 min** | **-1 ~ 5** | 絕對主力，波動極小，極低機率扣時。 |
| **先發 (Starter)** | **20 min** | **-2 ~ 7** | 主力球員，有較高機率獲得額外時間。 |
| **綠葉 (Rotation)**| **10 min** | **5 ~ 15** | 輪替核心，主要競爭剩餘時間的族群。 |
| **功能 (Role)** | **0 min** | **5 ~ 12** | 無保底，需靠權重爭取上場。 |
| **板凳 (Bench)** | **0 min** | **0 ~ 10** | 邊緣人，權重範圍大，可能 DNP 也可能爆發。 |

### 6.3 分配演算法 (Algorithm)

#### 步驟 1：計算總保底與剩餘時間
*   `Total_Base` = 所有球員保底時間總和。
*   `Remaining_Time` = 240 - `Total_Base`。

#### 步驟 2：生成單場權重
*   為每位球員隨機生成一個權重值 `W` (介於該角色的 Min ~ Max 之間)。
*   `Total_Weight` = 所有球員權重總和。

#### 步驟 3：計算單位時間價值 (Unit Value)
*   `Unit` = `Remaining_Time` / `Total_Weight`。

#### 步驟 4：計算個人時間
*   `Raw_Minutes` = `Base` + (`W` * `Unit`)。
*   **捨去規則**：取至小數點後第一位，第二位以後無條件捨去 (Floor)。
    *   公式：`Final_Minutes = floor(Raw_Minutes * 10) / 10`。

#### 步驟 5：尾數修正
*   由於捨去規則，分配後的總時間通常會略小於 240 分鐘。
*   **修正方式**：將剩餘的尾數 (通常 < 1 分鐘) 全部加給名單中的 **最後一位球員**。

### 6.4 範例模擬
假設剩餘時間 130 分鐘，總權重 65，則 `Unit = 2`。
*   **Star (W=-1)**: 30 + (-1 * 2) = **28 min**。
*   **Starter (W=7)**: 20 + (7 * 2) = **34 min** (手感火燙，上場時間超越明星)。
*   **Bench (W=0)**: 0 + (0 * 2) = **0 min** (DNP)。